
DSYSTEM_OS = Linux-i686
CC = gcc
CXX = g++
BISON = bison
FLEX = flex
DSYSTEM_SRC = /home/carr/cs6030/DSystem/src
PABLO_INC = /home/carr/cs6030/DSystem/lib/pablo/include
OKIND     = $(DSYSTEM_OS)-g
OBJS = $(addsuffix .o,$(basename $(SRCS)))

#-----------------------------------------------------------------
# Configuration archive
#-----------------------------------------------------------------
CONFIG = $(DSYSTEM_SRC)/libs/config/Config-$(OKIND).a

#-----------------------------------------------------------------
# Front End archives
#-----------------------------------------------------------------
FRONT_END = $(DSYSTEM_SRC)/libs/frontEnd/FrontEnd-$(OKIND).a

FRONT_END_PTREE = $(DSYSTEM_SRC)/libs/frontEnd/prettyPrinter/FrontEnd-$(OKIND).a

#-----------------------------------------------------------------
# Module Analysis archives
#-----------------------------------------------------------------
MA_CFG    = $(DSYSTEM_SRC)/libs/moduleAnalysis/cfg/ModuleAnalysis-$(OKIND).a
MA_CFGVAL = $(DSYSTEM_SRC)/libs/moduleAnalysis/cfgValNum/ModuleAnalysis-$(OKIND).a
MA_SSA    = $(DSYSTEM_SRC)/libs/moduleAnalysis/ssa/ModuleAnalysis-$(OKIND).a
MA_VAL    = $(DSYSTEM_SRC)/libs/moduleAnalysis/valNum/ModuleAnalysis-$(OKIND).a
MA_DEP    = $(DSYSTEM_SRC)/libs/moduleAnalysis/dependence/ModuleAnalysis-$(OKIND).a

#-----------------------------------------------------------------
# Support archive
#-----------------------------------------------------------------
SUPPORT = $(DSYSTEM_SRC)/libs/support/Support-$(OKIND).a
#-----------------------------------------------------------------
# The libraries in link order for command line interface apps
#-----------------------------------------------------------------
NLIBS = \
	   $(F2I) \
	   $(MEMORIA) \
	   $(MA_DEP) \
	   $(MA_CFGVAL) \
	   $(MA_SSA) \
	   $(MA_CFG) \
	   $(FRONT_END) \
	   $(MA_VAL) \
	   $(SUPPORT) \
	   $(CONFIG)

ENV = -g

INCLUDES=  \
	-I. \
	-I$(PABLO_INC) \
	-I$(DSYSTEM_SRC)

CFLAGS	= $(INCLUDES) -DLONG_POINTER -DLINUX $(ENV) -static 
CXXFLAGS	= $(INCLUDES) -DLONG_POINTER -DLINUX -fpermissive -Wno-conversion-null -Wno-write-strings -Wno-deprecated -static $(ENV) 		  
ARFLAGS = rU

RM = /bin/rm -f
SED = /bin/sed

.SILENT:

DEPENDS = $(addprefix .d_, $(basename $(SRCS)))

LEX_YACC_DEPENDS = $(addprefix .d_,$(LEX_SRCS )) $(addprefix .d_,$(YACC_SRCS))

LP = (
RP = )
ARCHIVE_OBJS = $(addsuffix $(RP),$(addprefix $(ARCHIVE)$(LP),$(notdir $(OBJS))))

.SUFFIXES: .c .C

$(ARCHIVE): $(ARCHIVE_OBJS)
	echo "Generating" $(ARCHIVE)
	ranlib $(ARCHIVE)


target: $(OBJS)
		echo "Done."

.PHONY: clean

clean:
		$(RM) $(OBJS) $(DEPENDS)

.c.o:
		echo "Compiling" $<
		$(CC) -c $(CFLAGS) $<

.C.o:
		echo "Compiling" $<
		$(CXX) -c $(CXXFLAGS) $<

.y.c:
	echo "Making $@..."
	$(BISON) -o $@ -d $<
	$(SED) s/yy/$(PREFIX)/g --in-place $@

.l.c:
	echo  "Making $@..."
	$(FLEX) $(FLEX_FLAGS) -o $@ $< 
	$(SED) s/yy/$(PREFIX)/g --in-place $@


.d_%: %.c
	echo  "Updating dependences for" $< "..."
	$(CPP) -D_STDARG_H -MM -MT '$(basename $<).o' $(INCLUDES) -MF $@ $<

.d_%: %.C
	echo  "Updating dependences for" $< "..."
	$(CPP) $(CXXFLAGS) -D_STDARG_H -MM -MT '$(basename $<).o' -MF $@ $<
#
# default rule to put all .o files in the archive and remove them
#

(%.o) : %.o
	$(AR) $(ARFLAGS) $@ $<

include $(DEPENDS)

# DO NOT DELETE THIS LINE -- make depend depends on it.
